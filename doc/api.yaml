openapi: 3.0.3
info:
  title: Simplified Login API
  description: >
    This OpenAPI document describes a WASAtext project.
  version: "1.0.0"

tags:
  - name: login
    description: Login and authorization
  - name: profile
    description: User profile
  - name: conversations
    description: Chats and conversations
  - name: messages
    description: Messages
  - name: groups
    description: Group management

paths:
  /session:
    post:
      tags:
        - login
      summary: Logs in the user
      description: >
        If the user does not exist, it is created and an identifier is returned.
        If the user already exists, the existing identifier is returned.
      operationId: doLogin
      requestBody:
        required: true
        description: User login data
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 3
                  maxLength: 16
                  pattern: "^.*$"
                  example: Maria
      responses:
        "200":
          description: User login successful or return UserID 
          content:
            application/json:
              schema:
                type: object
                required:
                  - identifier
                properties:
                  identifier:
                    type: string
                    example: abcdef012345

  /me:
    patch:
      tags:
        - profile
      summary: Updates my username
      description: Updates the username of the authenticated user.
      operationId: setMyUserName
      security:
        - bearerAuth: []
      requestBody:
        required: true
        description: New username
        content:
          application/json:
            schema:
              type: object
              required:
                - username
              properties:
                username:
                  type: string
                  minLength: 5
                  maxLength: 16
                  example: TMPkl2137
      responses:
        "400":
          description: Invalid username
        "401":
          description: Unauthorized (missing or invalid token)
  /conversations/me:
    get:
      tags: 
        - messages
      summary: Get all conversations
      description: Retrieves the list of conversations for loggeg in user, last text snippets, timestamps and text status for all friends
      operationId: getMyConversations
      security: 
        - bearerAuth: []
      responses:
        '200': 
          description: conversations data, request successful proccesed
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Conversation'
        '401':
          description: Unauthorized request, JWT key is wrong
  /conversations/with/{userId}:
    get: 
      tags: 
        - messages
      summary: Get conversation with single User
      operationId: getConversation
      security: 
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: user ID with whom the conversation is
          schema:
            type: string
      responses:
        '200': 
          description: conversations data, request successful proccesed
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Conversation'
        '401':
          description: Unauthorized request, JWT key is wrong
        '404':
          description: Convers with UserID does not exist

  /conversations/with/{userId}/sendMessage:
    post:
      tags:
        - messages
      summary: Send a message
      description: Send a single message to a user
      operationId: sendMessage
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreate'
      responses:
          "201":
            description: Message successful send
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Message'
          "400":
            description: Invalid input data
          "401":
            description: Unauthorized (missing or invalid token)
  /conversations/{messageId}/forward:
    post:
      tags:
        - messages
      summary: forward a message
      description: forward a single message to a user
      operationId: forwardMessage
      security:
        - bearerAuth: []
      parameters:
          - name: messageId
            in: path
            required: true
            schema:
              type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreate'
      responses:
          "201":
            description: Message successful forwarded
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Message'
          "400":
            description: Invalid input data
          "401":
            description: Unauthorized (missing or invalid token)
          "404":
            description: Original message or receiver not found
  /conversations/{messageId}/comment:
    post:
      tags:
        - messages
      summary: comment a message
      description: comment a single message to a user
      operationId: commentMessage
      security:
        - bearerAuth: []
      parameters:
          - name: messageId
            in: path
            required: true
            schema:
              type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreate'
      responses:
          "201":
            description: Message successful commented
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Message'
          "400":
            description: Invalid input data
          "401":
            description: Unauthorized (missing or invalid token)
          "404":
            description: Original message not found
            

#---------------------- Schemas ----------------------#
          

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas: 
    Conversation:
      type: object
      properties:
        id:
          type: string
        participants:
          type: array
          items:
            type: string
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
    Message:
      type: object
      properties:
        id:
          type: string
        conversationId:
          type: string
        senderId:
          type: string
        content:
          type: string
        timestamp:
          type: string
          format: date-time
        status:
          type: string
          enum:
            - sent
            - delivered
            - read
        attachments:
          type: array
          items:
            type: string  #tak jak wczesnij, kto wie co zrobic
    MessageCreate:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          example: Hello, how are you?
          minLength: 1
          maxLength: 500
        attachments:
          type: array
          items:
            type: string  # tez nie wiem czy to porpawan metoda robienia tego ale wywalone
          description: attachemnts URLs? #jeszcze zobacze jak to zrobic 
        respondedToMessageId:
          type: string
          description: ID of the message being responded to